(function(){var require=function(e,r){var t=require.resolve(e,r||"/"),n=require.modules[t];if(!n)throw Error("Failed to resolve module "+e+", tried "+t);var o=require.cache[t],i=o?o.exports:n();return i};require.paths=[],require.modules={},require.cache={},require.extensions=[".js",".coffee",".json"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(e,r){function t(e){if(e=a.normalize(e),require.modules[e])return e;for(var r=0;require.extensions.length>r;r++){var t=require.extensions[r];if(require.modules[e+t])return e+t}}function n(e){e=e.replace(/\/+$/,"");var r=a.normalize(e+"/package.json");if(require.modules[r]){var n=require.modules[r](),o=n.browserify;if("object"==typeof o&&o.main){var i=t(a.resolve(e,o.main));if(i)return i}else if("string"==typeof o){var i=t(a.resolve(e,o));if(i)return i}else if(n.main){var i=t(a.resolve(e,n.main));if(i)return i}}return t(e+"/index")}function o(e,r){for(var o=i(r),a=0;o.length>a;a++){var u=o[a],s=t(u+"/"+e);if(s)return s;var c=n(u+"/"+e);if(c)return c}var s=t(e);return s?s:void 0}function i(e){var r;r="/"===e?[""]:a.normalize(e).split("/");for(var t=[],n=r.length-1;n>=0;n--)if("node_modules"!==r[n]){var o=r.slice(0,n+1).join("/")+"/node_modules";t.push(o)}return t}if(r||(r="/"),require._core[e])return e;var a=require.modules.path();r=a.resolve("/",r);var u=r||"/";if(e.match(/^(?:\.\.?\/|\/)/)){var s=t(a.resolve(u,e))||n(a.resolve(u,e));if(s)return s}var c=o(e,u);if(c)return c;throw Error("Cannot find module '"+e+"'")}}(),require.alias=function(e,r){var t=require.modules.path(),n=null;try{n=require.resolve(e+"/package.json","/")}catch(o){n=require.resolve(e,"/")}for(var i=t.dirname(n),a=(Object.keys||function(e){var r=[];for(var t in e)r.push(t);return r})(require.modules),u=0;a.length>u;u++){var s=a[u];if(s.slice(0,i.length+1)===i+"/"){var c=s.slice(i.length);require.modules[r+c]=require.modules[i+c]}else s===i&&(require.modules[r]=require.modules[i])}},function(){var e={},r="undefined"!=typeof window?window:{},t=!1;require.define=function(n,o){!t&&require.modules.__browserify_process&&(e=require.modules.__browserify_process(),t=!0);var i=require._core[n]?"":require.modules.path().dirname(n),a=function(e){var r=require(e,i),t=require.cache[require.resolve(e,i)];return t&&null===t.parent&&(t.parent=u),r};a.resolve=function(e){return require.resolve(e,i)},a.modules=require.modules,a.define=require.define,a.cache=require.cache;var u={id:n,filename:n,exports:{},loaded:!1,parent:null};require.modules[n]=function(){return require.cache[n]=u,o.call(u.exports,a,u,u.exports,i,n,e,r),u.loaded=!0,u.exports}}}(),require.define("path",function(e,r,t,n,o,i){function a(e,r){for(var t=[],n=0;e.length>n;n++)r(e[n],n,e)&&t.push(e[n]);return t}function u(e,r){for(var t=0,n=e.length;n>=0;n--){var o=e[n];"."==o?e.splice(n,1):".."===o?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t--;t)e.unshift("..");return e}var s=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;t.resolve=function(){for(var e="",r=!1,t=arguments.length;t>=-1&&!r;t--){var n=t>=0?arguments[t]:i.cwd();"string"==typeof n&&n&&(e=n+"/"+e,r="/"===n.charAt(0))}return e=u(a(e.split("/"),function(e){return!!e}),!r).join("/"),(r?"/":"")+e||"."},t.normalize=function(e){var r="/"===e.charAt(0),t="/"===e.slice(-1);return e=u(a(e.split("/"),function(e){return!!e}),!r).join("/"),e||r||(e="."),e&&t&&(e+="/"),(r?"/":"")+e},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(a(e,function(e){return e&&"string"==typeof e}).join("/"))},t.dirname=function(e){var r=s.exec(e)[1]||"",t=!1;return r?1===r.length||t&&3>=r.length&&":"===r.charAt(1)?r:r.substring(0,r.length-1):"."},t.basename=function(e,r){var t=s.exec(e)[2]||"";return r&&t.substr(-1*r.length)===r&&(t=t.substr(0,t.length-r.length)),t},t.extname=function(e){return s.exec(e)[3]||""}}),require.define("__browserify_process",function(e,r,t,n,o,i){var i=r.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,r="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(r){var t=[];return window.addEventListener("message",function(e){if(e.source===window&&"browserify-tick"===e.data&&(e.stopPropagation(),t.length>0)){var r=t.shift();r()}},!0),function(e){t.push(e),window.postMessage("browserify-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.binding=function(r){if("evals"===r)return e("vm");throw Error("No such module. (Possibly not yet loaded)")},function(){var r,t="/";i.cwd=function(){return t},i.chdir=function(n){r||(r=e("path")),t=r.resolve(n,t)}}()}),require.define("/lib/index.js",function(require,module,exports,__dirname,__filename,process,global){var fs=require("fs"),path=require("path");if(require("./browser_support"),"undefined"==typeof window)var isBrowser=!1;else var isBrowser=!0;var isNode=!isBrowser;if(isNode&&/bright/gim.test(process.env.DEBUG)||isBrowser&&"undefined"!=typeof _BRIGHT_DEBUG)var debug=console.log;else var debug=function(){};var runtime=exports.runtime=require("./runtime/core"),define=exports.define=require("./compiler/define"),parser=exports.parser=require("./compiler/parser");if(exports.compile=function(source){var $$_runtime=runtime,$$_javascript=parser.parse(source);debug($$_javascript);var fn=eval($$_javascript);if("function"!=typeof fn)var tmpName="$$_ie_"+Date.now()+parseInt(1e5*Math.random()),fn=eval("var "+tmpName+"="+$$_javascript+";"+tmpName);return fn},exports._wrapFile=function(e){return"(function () {\n"+exports._wrapGetRuntime()+e+"(function (err) {\n"+"  if (err) console.error(err && err.stack);\n"+"});\n"+"})();"},exports._wrapGetRuntime=function(){return'\nif (typeof(window) === "undefined") {\n  var $$_runtime = require("bright").runtime;\n} else {\n  var $$_runtime = Bright.runtime;\n}\n'},isNode)require.extensions[".bright"]=function(e,r){e.exports=exports.load(r)},exports.load=function(e){var r=fs.readFileSync(e,"utf8"),t=parser.parse(r);t='var $$_runtime = require("bright").runtime;\n'+t+"(function (err) {\n"+"  if (err) console.error(err && err.stack);\n"+"});";var n=e+".compile.js";return fs.writeFileSync(n,t),require(n)};else{window.Bright===void 0?window.Bright=module.exports:console.error('Cannot register namespace "Bright".');var run=function(e){var r=exports.compile(e);r(function(e){e&&console.error(e&&e.stack)})};exports.load=function(e,r){var t=window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;return t.open("GET",e,!0),"overrideMimeType"in t&&t.overrideMimeType("text/plain"),t.onreadystatechange=function(){var n;if(4===t.readyState){if(0!==(n=t.status)&&200!==n)throw Error("Could not load "+e);if(run(t.responseText),r)return r()}},t.send(null)};var runScripts=function(){for(var e=document.getElementsByTagName("script"),r=0,t=e.length;t>r;r++){var n=e[r];n&&n.type&&"text/bright"===n.type&&(n.src?exports.load(n.src):run(n.innerHTML))}};window.addEventListener?addEventListener("DOMContentLoaded",runScripts,!1):attachEvent("onload",runScripts)}}),require.define("fs",function(){}),require.define("/lib/browser_support.js",function(){"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var r=this.length,t=0;r>t;t++)e(this[t],t,this)}),"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(e){for(var r=0,t=this.length;t>r;r++)if(this[r]===e)return r;return-1}),"function"!=typeof Array.isArray&&(Array.isArray=function(e){return e instanceof Array?!0:!1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*((?:[\S\s]*\S)?)\s*$/,"$1")})}),require.define("/lib/runtime/core.js",function(e,r){var t=r.exports;t.error=function(){console.error.apply(console,arguments)},t.runDefers=function(e,r,t){var n=function(o){o&&console.error(o&&o.stack);var i=e.shift();if("function"!=typeof i)return t(null);try{i(r,n)}catch(o){n(o)}};n()},t.ifCondition=function(){for(var e=[],r=0,t=arguments.length;t>r;r+=2){var n=[arguments[r],arguments[r+1]];e.push(n)}var o=e.pop(),i=!1,a=function(){"function"==typeof o[1]?i?o[1](null):o[0](function(){o[1](null)}):o[0](null)},u=function(){var r=e.shift();r?(i=r[0],r[0]?r[1](u):u()):a()};u()},t.conditionLoop=function(e,r,t){var n=function(){e()?r(n,t):t()};n()},t.forEachLoop=function(e,r,t){var n=Object.keys(e),o=function(){if(n.length>0){var e=n.shift();r(e,o,t)}else t()};o()},t.sleep=function(e,r){setTimeout(function(){r(null,e)},e)},t.parseArguments=function(e){var r={arguments:[]};r.callback=e[e.length-1];for(var t=0,n=e.length-1;n>t;t++)r.arguments.push(e[t]);return r}}),require.define("/lib/compiler/define.js",function(e,r,t){t.TOKEN={BLANK:0,SYMBLE:1,NUMBER:2,STRING:4,NAME:8,KEYWORD:16,IDENTIFIER:32,COMMENT:64},t.KEYWORD=["argument","var","let","throw","function","if","else","elseif","for","in","break","continue","return","await","sleep","defer","true","false","null","undefined","NaN"]}),require.define("/lib/compiler/parser.js",function(e,r,t){var n=e("./define"),o=e("./token"),i=e("./syntax");n.TOKEN;var a=function(e,r,t,n){var o=50;console.log("[33m"),console.log("\n"),console.log(n),console.log("Line: "+(r+1)+", Column: "+(t+1)),console.log("");var i=e[r];if(i){if(t>o){var a=t-o;i=i.substr(a),t-=a}console.log(i);for(var u="",r=0;t>r;r++)u+=32>=i.charCodeAt(r)?i[r]:" ";console.log(u+"^")}return console.log("[39;49m"),i+"\n"+u};t.parse=function(e){var r=function(r,t,n){var o=Error(n);o.line=r,o.column=t;var i=e.split(/\r?\n/gm);throw a(i,o.line,o.column,n),o},t=function(e,t,n){r(e,t,"SyntaxError: "+n)},n=o.parse(e);if(!Array.isArray(n))return n instanceof Error?r(0,0,n.message):r(n.line,n.column,n.error);try{var u=i.parse(n);return u}catch(s){var c=s.token;if(!c)throw s;t(c.line,c.column,s.error)}}}),require.define("/lib/compiler/token.js",function(e,r,t){var n=e("./define"),o=n.TOKEN,i=n.KEYWORD,a={};i.forEach(function(e){a[e]=!0});var u={BLANK:0,SYMBLE:1,NUMBER:2,STRING:4,NAME:8,COMMENT_1:16,COMMENT_2:32},s={NUMBER_BEGIN:48,NUMBER_END:57,LOWER_BEGIN:97,LOWER_END:122,UPPER_BEGIN:65,UPPER_END:90,UNDERLINE:95,QUOTE_1:39,QUOTE_2:34,BACKSLASH:92,DOLLAR:36,STAR:42,FORWARDSLASH:47},c=function(e){return e>=s.NUMBER_BEGIN&&s.NUMBER_END>=e?!0:!1},f=function(e){return e>=s.UPPER_BEGIN&&s.UPPER_END>=e||e>=s.LOWER_BEGIN&&s.LOWER_END>=e||e===s.UNDERLINE||e===s.DOLLAR?!0:!1},l=function(e){return isNaN(e)||32>=e?!0:!1},p=function(e){return e===s.QUOTE_1||e===s.QUOTE_2?!0:!1},d=function(e){return 10===e||13===e?!0:!1},h=function(e){return a[e]?!0:!1};t._parse=function(e){e+=" ";var r,t=e.length,n=0,i=0,a=0,h={line:0,column:0},v=u.BLANK,E=[],x=!1,g=!1,m=!1,L=!1,N=!1,w=function(){i++,a=0},$=function(t){if(13===t)w();else if(10===t){var n=e.charCodeAt(r-1);13===n||w()}else a++},y=function(e){v=e,h={line:i,column:a-1}},_=function(t){if(r>n){var i=e.slice(n,r);i=i.trim();var a={type:t,line:h.line,column:h.column,text:i};t===o.BLANK?a.column>0&&(a.text=" ",E.push(a)):(t===o.STRING&&(a.text=a.text.replace(/\n/gm,"\\n").replace(/\r/gm,"\\r")),E.push(a))}n=r,x=!1,g=!1,m=!1,L=!1,N=!1},k=function(){var t=e.charCodeAt(r);$(t),c(t)?y(u.NUMBER):f(t)?y(u.NAME):l(t)?y(u.BLANK):y(u.SYMBLE)},b=function(e){var e={error:"SyntaxError: "+e,line:i,column:a-1};throw e};try{for(r=0;t>r;r++){var M=e[r],A=e.charCodeAt(r);switch($(A),v){case u.BLANK:c(A)?(_(o.BLANK),y(u.NUMBER)):f(A)?(_(o.BLANK),y(u.NAME)):p(A)?(_(o.BLANK),x=A,y(u.STRING)):l(A)||(_(o.BLANK),y(u.SYMBLE));break;case u.NUMBER:c(A)||(f(A)?g!==!1||"e"!==M&&"E"!==M?b("Unexpected token "+M):(g=!0,L=!1,m=!1):l(A)?(_(o.NUMBER),y(u.BLANK)):"."===M?m?b("Unexpected token "+M):m=!0:g&&"+"===M||"-"===M?L?b("Unexpected token "+M):L=!0:(_(o.NUMBER),y(u.SYMBLE)));break;case u.NAME:c(A)||f(A)||(l(A)?(_(o.NAME),y(u.BLANK)):"_"===M||(_(o.NAME),y(u.SYMBLE)));break;case u.SYMBLE:var S=e.charCodeAt(r-1);A===s.FORWARDSLASH&&S===s.FORWARDSLASH?v=u.COMMENT_1:S===s.FORWARDSLASH&&A===s.STAR?v=u.COMMENT_2:(_(o.SYMBLE),c(A)?y(u.NUMBER):f(A)?y(u.NAME):l(A)?y(u.BLANK):p(A)?(x=A,y(u.STRING)):y(u.SYMBLE));break;case u.STRING:A===x&&N===!1?(r++,_(o.STRING),k()):A===s.BACKSLASH?N=!N:N&&(N=!1);break;case u.COMMENT_1:(d(A)||r>=t-2)&&(r++,_(o.COMMENT),k());break;case u.COMMENT_2:if(A===s.STAR){var B=e.charCodeAt(r+1);B===s.FORWARDSLASH&&(r+=2,_(o.COMMENT),$(),k())}break;default:b("Unexpected token ILLEGAL")}}if(v===u.BLANK)return E;b("Unexpected end of input")}catch(R){return R}},t.parse=function(e){var r=t._parse(e);if(!Array.isArray(r))return r;for(var n=0;r.length>n;n++)(function(e,t){switch(e.type){case o.NAME:if(h(e.text)){var n=r[t-1],i=r[t+1];n=n&&n.type===o.SYMBLE?n.text:null,i=i&&i.type===o.SYMBLE?i.text:null,e.type="."===n||"."===i?o.IDENTIFIER:"{"!==n&&","!==n||":"!==i?o.KEYWORD:o.IDENTIFIER}else e.type=o.IDENTIFIER;break;case o.NUMBER:var n=r[t-1];if(n&&n.type===o.SYMBLE&&"."===n.text&&n.column+1===e.column&&n.line===e.line){var a=r[t-2];if(!a||a.type===o.SYMBLE){var u={type:o.NUMBER,text:n.text+e.text,line:n.line,column:n.column};r[t-1]=u,r.splice(t,1),t--}}break;case o.SYMBLE:var i=r[t+1];if(i&&e.line===i.line&&("+"===e.text&&"+"===i.text||"-"===e.text&&"-"===i.text||"<"===e.text&&"<"===i.text||">"===e.text&&">"===i.text||"="===e.text&&"="===i.text||">"===e.text&&"="===i.text||"<"===e.text&&"="===i.text||"!"===e.text&&"="===i.text)){var u={type:o.SYMBLE,text:e.text+i.text,line:e.line,column:e.column},s=r[t+2];"="!==e.text&&"!"!==e.text||"="!==i.text||!s||s.type!==o.SYMBLE||"="!==s.text?r.splice(t+1,1):(u.text+=s.text,r.splice(t+1,2)),r[t]=u}}})(r[n],n);var i=["true","false","null","undefined","NaN"];return r.forEach(function(e){e.type===o.KEYWORD&&-1!==i.indexOf(e.text)&&(e.type=o.IDENTIFIER)}),r}}),require.define("/lib/compiler/syntax.js",function(e,r){var t=e("./define");e("./token");var n=t.TOKEN,o=r.exports;o.readLine=function(e){if(e[0]){for(var r=e[0].line,t=1,n=e.length;n>t&&e[t].line===r;t++);return{line:e.slice(0,t),next:e.slice(t)}}return!1},o.throwWordError=function(e,r){r||(r="Unexpected token "+e.text);var t=Error(r);throw t.error=r,t.token=e,console.error(t.stack),t},o.codePushLine=function(e,r){var t=o.getIndentSpace(e);e.code.push(t+r)},o.getIndentSpace=function(e){for(var r="",t=0;e.indent>t;t++)r+="  ";return r},o.newContext=function(e){var r={};for(var t in e)r[t]=e[t];return r.defers=[],r.code=[],r},o.addReturnAtEnd=function(e,r){var t=e[e.length-1];if(t){var o={type:n.KEYWORD,line:t.line+1,column:0,text:"return"};r&&(o.isNested=r),e.push(o)}return e},o.parseCondition=function(e){var r=e[e.length-1];if(r.type!==n.SYMBLE||"{"!==r.text)return o.throwWordError(r);e.pop();var t="";return e.forEach(function(e){t+=e.type===n.SYMBLE&&"="===e.text?" == ":e.text}),"("+t+")"},o.parseMultiArgument=function(e){for(var r=[],t=0,i=function(i){if(i>t){var a="",u=[];if(e.slice(t,i).forEach(function(e){if(a+=e.text,e.type===n.SYMBLE)if("["===e.text||"("===e.text)u.push(e.text);else if("]"===e.text||")"===e.text){var r=u.pop();if(!("]"===e.text&&"["===r||")"===e.text&&"("===r))return o.throwWordError(e,"brackets do not match")}}),u.length>0)return o.throwWordError(s,"brackets do not match");r.push(a),t=i+1}},a=0,u=e.length;u>a;a++){var s=e[a];if(s.type===n.SYMBLE)if(","===s.text)i(a);else if("="===s.text){i(a);break}}return{names:r,next:e.slice(a+1)}},o.getMultiArgumentsCode=function(e){var r=[],t=[];return e.forEach(function(e,n){r.push("$$_arg_"+n),t.push(e+" = $$_arg_"+n+";")}),{args:r,init:t}},o.parseMultiValue=function(e){for(var r=[],t=0,i=function(i){if(i>t){var a="",u=[];if(e.slice(t,i).forEach(function(e){if(a+=e.text,e.type===n.SYMBLE)if("["===e.text||"("===e.text)u.push(e.text);else if("]"===e.text||")"===e.text){var r=u.pop();if(!("]"===e.text&&"["===r||")"===e.text&&"("===r))return o.throwWordError(e,"brackets do not match")}}),u.length>0)return o.throwWordError(s,"brackets do not match");r.push(a),t=i+1}},a=0,u=e.length;u>a;a++){var s=e[a];s.type===n.SYMBLE&&","===s.text&&i(a)}return i(a),r},o.noBlankToken=function(e){var r=[];return e.forEach(function(e){e.type!==n.BLANK&&r.push(e)}),r},o.wrap=function(e){if(e.vars.length>0)var r="    var "+e.vars.join(", ")+";\n";else var r="";if(e.defers.length>0){var t="    ",n=["\n"+t+"/* defer function start */",t+"var $$_defers = [];"];e.defers.forEach(function(e){n.push(t+"$$_defers.push("+e+");")}),n.push(t+"var $$_oldCallback = $$_callback;"),n.push(t+"$$_callback = $$_callback_global = function () {"),n.push(t+"  var $$_args = arguments;"),n.push(t+"  $$_runtime.runDefers($$_defers, $$_args[0], function (err) {"),n.push(t+"    if (err) $$_runtime.error(err.stack);"),n.push(t+"    $$_oldCallback.apply(null, $$_args);"),n.push(t+"  });"),n.push(t+"};"),n.push(t+"/* defer function end */\n"),n=n.join("\n")+"\n"}else n="";var t=o.getIndentSpace(e).substr(4),i="(function ("+e.args.join(", ")+") {\n"+t+'  "use strict";\n\n'+t+"  /* function header start */\n"+t+"  var $$_callback, $arguments;\n"+t+'  if (arguments.length < 1 || typeof(arguments[arguments.length - 1]) !== "function") {\n'+t+'    throw new Error("Need a callback parameter.");\n'+t+"  } else {\n"+t+"    $arguments = $$_runtime.parseArguments(arguments);\n"+t+"    $$_callback = $arguments.callback;\n"+t+"    $arguments = $arguments.arguments\n"+t+"  }\n"+t+"  var $$_callback_global = $$_callback;\n"+t+"  /* function header end */\n\n"+t+"  try {\n"+(r?t+r:"")+(n?t+n:"")+e.code.join("\n")+"\n"+t+"  } catch (err) {\n"+t+"    return $$_callback_global(err);\n"+t+"  }\n"+t+"})";return i},o.parse=function(e,r){if(r)var t=e;else var t={args:[],vars:[],defers:[],tokenList:e,code:[],indent:2};r||(t.tokenList=o.addReturnAtEnd(t.tokenList));for(var i,a=function(e,r){o.codePushLine(t,"/* LINE:"+(e.line+1)+" "+r+" */")};i=o.readLine(t.tokenList);){var u=i.line;t.tokenList=i.next;var s=u[0],c=u.slice(1);if(s.type===n.BLANK);else if(s.type===n.KEYWORD){var f=function(){return 1>c.length?o.throwWordError(s,"Unexpected end of input"):void 0};switch(c=o.noBlankToken(c),s.text){case"argument":f(),o.parseArgument(t,c);break;case"var":f(),o.parseVar(t,c);break;case"let":f(),a(s,"START"),o.parseLet(t,c),a(s,"END");break;case"await":f(),a(s,"START"),o.parseAwait(t,"",c),a(s,"END");break;case"sleep":f(),a(s,"START"),o.parseSleep(t,c),a(s,"END");break;case"function":f(),a(s,"START"),o.parseFunction(t,"",c),a(s,"END");break;case"return":a(s,"START"),o.parseReturn(t,c,s.isNested),a(s,"END");break;case"defer":f(),o.parseDefer(t,c);break;case"if":f(),a(s,"START"),o.parseIf(t,c),a(s,"END");break;case"for":f(),a(s,"START"),o.parseFor(t,c),a(s,"END");break;case"break":a(s,"START"),o.codePushLine(t,"return $$_break(null);"),a(s,"END");break;case"continue":a(s,"START"),o.codePushLine(t,"return $$_continue(null);"),a(s,"END");break;case"throw":a(s,"START"),o.parseThrow(t,c),a(s,"END");break;default:return o.throwWordError(s)}}else a(s,"START"),o.parseExpression(t,"",u),a(s,"END")}return r?void 0:o.wrap(t)},o.parseNested=function(e,r){for(var t,i=e.tokenList,a=[],u=0;t=o.readLine(i);){i=t.next;var s=o.noBlankToken(t.line),c=s[0],f=s[s.length-1];if(c.type===n.SYMBLE&&"}"===c.text?u--:f.type===n.SYMBLE&&"{"===f.text&&u++,0>u){s.length>1&&(i=s.slice(1).concat(i));break}a=a.concat(s)}r&&(a=o.addReturnAtEnd(a,!0)),e.tokenList=a,o.parse(e,!0),e.tokenList=i},o.parseArgument=function(e,r){var t=!1;r.forEach(function(r){r.type===n.IDENTIFIER?(t=!1,e.args.push(r.text)):r.type!==n.SYMBLE||","!==r.text||t?o.throwWordError(r):t=!0})},o.parseVar=function(e,r){var t=[],i=!1,a=null,u=[],s=r[r.length-1];r.push({type:n.SYMBLE,text:",",line:s.line,column:s.column+s.text.length}),r.forEach(function(r){if(i)if(r.type===n.SYMBLE)if("("===r.text||"["===r.text)u.push(r),t.push(r);else if(")"===r.text){var s=t.pop();if("("!==s.text)return o.throwWordError(r);u.push(r)}else if("]"===r.text){var s=t.pop();if("["!==s.text)return o.throwWordError(r);u.push(r)}else","===r.text&&(t.length>0?u.push(r):(u.push({type:n.SYMBLE,text:";",line:r.line,column:r.column}),o.parseExpression(e,a,u),i=!1));else u.push(r);else if(r.type===n.IDENTIFIER)e.vars.push(r.text),a=r.text,t=[],u=[];else{if(!a||r.type!==n.SYMBLE)return o.throwWordError(r);if(","===r.text)i=!1;else{if("="!==r.text)return o.throwWordError(r);i=!0}}})},o.parseLet=function(e,r){if(3>r.length)return o.throwWordError(r[r.length-1],"Unexpected end of input");var t=o.parseMultiArgument(r),i=t.names;if(1>t.next.length)return o.throwWordError(r[r.length-1],"Unexpected end of input");if(r=t.next,r[0].type===n.KEYWORD)if("await"===r[0].text){if(!r[1])return o.throwWordError(r[0],"Unexpected end of input");o.parseAwait(e,i,r.slice(1))}else{if("function"!==r[0].text)return o.throwWordError(r[0]);if(!r[1])return o.throwWordError(r[0],"Unexpected end of input");if(i.length>1)return o.throwWordError(r[0],"Not support tuple assignment");o.parseFunction(e,i[0],r.slice(1))}else{if(i.length>1)return o.throwWordError(r[0],"Not support tuple assignment");o.parseExpression(e,i[0],r)}},o.parseExpression=function(e,r,t){var i="",a=!1;t.forEach(function(e){e.type===n.IDENTIFIER||e.type===n.KEYWORD?(i+=(a?" ":"")+e.text,a=!0):(i+=e.text,a=!1)}),i=(r?r+" = ":"")+i.trim(),o.codePushLine(e,i)},o.parseAwait=function(e,r,t){var i=t[0];if(1===t.length&&i.type===n.NUMBER)return o.throwWordError(i);if(t[0].type!==n.IDENTIFIER)return o.throwWordError(t[0]);var a=t[t.length-1];if(a.type===n.SYMBLE&&")"===a.text){var u="";t.slice(0,t.length-1).forEach(function(e){u+=e.text});var s=t[t.length-2];s&&s.type===n.SYMBLE&&"("===s.text||(u+=", ")}else{var u="";t.forEach(function(e){u+=e.text}),u+="("}if(r.length>0)var c=o.getMultiArgumentsCode(r);u+="function ("+(r.length>0?c.args.join(", "):"")+") {",o.codePushLine(e,u),e.indent++,r.length>0&&c.init.forEach(function(r){o.codePushLine(e,r)}),o.parse(e,!0),e.indent--,o.codePushLine(e,"});")},o.parseReturn=function(e,r,t){var n=["null"];r.length>0&&(n=n.concat(o.parseMultiValue(r))),o.codePushLine(e,"return $$_callback"+(t?"":"_global")+"("+n.join(", ")+");")},o.parseDefer=function(e,r){var t=r[r.length-1],i="function (error, $$_callback) {\n",a="\n    }";if(t.type===n.SYMBLE)if(")"===t.text&&r.length>=3){var u="";r.forEach(function(e){u+=e.text}),u="      "+u+";\n      return $$_callback(null);",e.defers.push(i+u+a)}else{if("{"!==t.text||1!==r.length)return o.throwWordError(t);var s=o.newContext(e);s.indent=3,o.parseNested(s,!0);var c=s.code.join("\n");e.defers.push(i+c+a),e.tokenList=s.tokenList}else{if(t.type!==n.IDENTIFIER)return o.throwWordError(t);var u="";r.forEach(function(e){u+=e.text}),u="      "+u+"();\n      return $$_callback(null);",e.defers.push(i+u+a)}},o.parseIf=function(e,r){var t=[],i=function(){var r=o.newContext(e);r.indent++,o.parseNested(r,!0),e.tokenList=r.tokenList;var t=r.code.join("\n");return t="function ($$_callback) {\n"+t+"\n"+o.getIndentSpace(e)+"}"};t.push(o.parseCondition(r)),t.push(i());var a=e.tokenList[0];if(a&&a.type===n.KEYWORD&&("else"===a.text||"elseif"===a.text))for(var u;u=o.readLine(e.tokenList);){var s=u.line;e.tokenList=u.next;var c=s[0],f=s.slice(1);if(c.type!==n.KEYWORD){e.tokenList=s.concat(e.tokenList);break}if("elseif"===c.text)t.push(o.parseCondition(f)),t.push(i());else{if("else"!==c.text){e.tokenList=s.concat(e.tokenList);break}t.push(i())}}var l=o.newContext(e);l.indent++,o.parseNested(l),e.tokenList=l.tokenList;var p=l.code.join("\n"),d="$$_runtime.ifCondition("+t.join(", ")+", function () {\n"+p+"\n"+o.getIndentSpace(e)+"});";o.codePushLine(e,d)},o.parseFor=function(e,r){var t=function(){var r=o.newContext(e);r.indent++,o.parseNested(r),e.tokenList=r.tokenList;var t=r.code.join("\n");return t};if(r.length>=3&&r[1].type===n.KEYWORD&&"in"===r[1].text){if(r[0].type!==n.IDENTIFIER)return o.throwWordError(r[0]);var i=r[0].text,a="";r.slice(2,r.length-1).forEach(function(e){a+=e.text});var u=o.newContext(e);u.indent++,o.parseNested(u,!0),e.tokenList=u.tokenList;var s=u.code.join("\n"),c=o.getIndentSpace(e),f="$$_runtime.forEachLoop("+a+", function ("+i+", $$_continue, $$_break) {\n"+c+"  var $$_callback = $$_continue;\n"+s+"\n"+c+"}, function () {\n"+t()+"\n"+c+"});";o.codePushLine(e,f)}else{if(1===r.length&&r[0].type===n.SYMBLE&&"{"===r[0].text)var l="true";else var l=o.parseCondition(r);var u=o.newContext(e);u.indent++,o.parseNested(u,!0),e.tokenList=u.tokenList;var s=u.code.join("\n"),c=o.getIndentSpace(e),f="$$_runtime.conditionLoop(function () {\n"+c+"  return "+l+";\n"+c+"}, function ($$_continue, $$_break) {\n"+c+"  var $$_callback = $$_continue;\n"+s+"\n"+c+"}, function () {\n"+t()+"\n"+c+"});";o.codePushLine(e,f)}},o.parseThrow=function(e,r){1>r.length?o.codePushLine(e,"return $$_callback_global(new Error());"):(o.parseExpression(e,"var $$_err",r),o.codePushLine(e,"return $$_callback_global($$_err);"))},o.parseFunction=function(e,r,t){var i=t[t.length-1];if(i.type!==n.SYMBLE||"{"!==i.text)return o.throwWordError(i);var a=[];if(1===t.length);else{var u=t.slice(0,t.length-1),s=u[0],i=u[u.length-1];if(s.type!==n.SYMBLE||"("!==s.text)return o.throwWordError(s);if(i.type!==n.SYMBLE||")"!==i.text)return o.throwWordError(s);var c=!0;u.slice(1,u.length-1).forEach(function(e){if(c&&e.type===n.IDENTIFIER)a.push(e.text),c=!1;else{if(c||e.type!==n.SYMBLE||","!==e.text)return o.throwWordError(e);c=!0}})}var f=o.newContext(e);f.vars=[],f.indent+=2,o.parseNested(f,!0),f.args=a;var l=o.wrap(f);o.codePushLine(e,"");var p=(r?r+" = ":"")+l+";";o.codePushLine(e,p),o.codePushLine(e,""),e.tokenList=f.tokenList},o.parseSleep=function(e,r){var t=r[r.length-1];r.push({type:n.SYMBLE,text:";",line:t.line,column:t.column+t.text.length+1}),o.parseExpression(e,"var $$_sleep_ms",r);var i="$$_runtime.sleep($$_sleep_ms, function ($$_err) {";o.codePushLine(e,i),e.indent++,o.parse(e,!0),e.indent--,o.codePushLine(e,"});")}}),require.define("/index.js",function(e,r){r.exports=e("./lib")}),require("/index.js")})();